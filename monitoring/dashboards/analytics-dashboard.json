{
  "dashboard": {
    "title": "Anclora Analytics & Conversions",
    "tags": ["anclora", "analytics", "conversions"],
    "timezone": "browser",
    "editable": true,
    "panels": [
      {
        "id": 1,
        "title": "Message Flow (Sent → Delivered → Read)",
        "type": "graph",
        "gridPos": { "x": 0, "y": 0, "w": 24, "h": 8 },
        "targets": [
          {
            "expr": "rate(anclora_analytics_messages_sent_total[5m])",
            "legendFormat": "Sent"
          },
          {
            "expr": "rate(anclora_analytics_messages_delivered_total[5m])",
            "legendFormat": "Delivered"
          },
          {
            "expr": "rate(anclora_analytics_messages_read_total[5m])",
            "legendFormat": "Read"
          }
        ],
        "yaxes": [
          { "label": "messages/s", "format": "short" },
          { "show": false }
        ]
      },
      {
        "id": 2,
        "title": "Delivery Rate (%)",
        "type": "gauge",
        "gridPos": { "x": 0, "y": 8, "w": 6, "h": 6 },
        "targets": [
          {
            "expr": "100 * rate(anclora_analytics_messages_delivered_total[5m]) / rate(anclora_analytics_messages_sent_total[5m])"
          }
        ],
        "options": {
          "showThresholdLabels": true,
          "showThresholdMarkers": true
        },
        "thresholds": {
          "steps": [
            { "value": 0, "color": "red" },
            { "value": 80, "color": "yellow" },
            { "value": 95, "color": "green" }
          ]
        }
      },
      {
        "id": 3,
        "title": "Read Rate (%)",
        "type": "gauge",
        "gridPos": { "x": 6, "y": 8, "w": 6, "h": 6 },
        "targets": [
          {
            "expr": "100 * rate(anclora_analytics_messages_read_total[5m]) / rate(anclora_analytics_messages_delivered_total[5m])"
          }
        ],
        "options": {
          "showThresholdLabels": true,
          "showThresholdMarkers": true
        },
        "thresholds": {
          "steps": [
            { "value": 0, "color": "red" },
            { "value": 40, "color": "yellow" },
            { "value": 60, "color": "green" }
          ]
        }
      },
      {
        "id": 4,
        "title": "Active Conversations",
        "type": "stat",
        "gridPos": { "x": 12, "y": 8, "w": 6, "h": 6 },
        "targets": [
          {
            "expr": "anclora_analytics_active_conversations"
          }
        ],
        "options": {
          "graphMode": "area",
          "colorMode": "value"
        }
      },
      {
        "id": 5,
        "title": "Avg Response Time",
        "type": "stat",
        "gridPos": { "x": 18, "y": 8, "w": 6, "h": 6 },
        "targets": [
          {
            "expr": "histogram_quantile(0.50, rate(anclora_analytics_response_time_seconds_bucket[5m]))"
          }
        ],
        "options": {
          "unit": "s",
          "graphMode": "area"
        }
      },
      {
        "id": 6,
        "title": "Conversions by Type",
        "type": "graph",
        "gridPos": { "x": 0, "y": 14, "w": 12, "h": 8 },
        "targets": [
          {
            "expr": "rate(anclora_analytics_conversions_total[5m])",
            "legendFormat": "{{conversion_type}}"
          }
        ],
        "yaxes": [
          { "label": "conversions/s", "format": "short" },
          { "show": false }
        ]
      },
      {
        "id": 7,
        "title": "Conversion Value (EUR)",
        "type": "graph",
        "gridPos": { "x": 12, "y": 14, "w": 12, "h": 8 },
        "targets": [
          {
            "expr": "rate(anclora_analytics_conversion_value_euros_sum[5m])",
            "legendFormat": "Total Value"
          }
        ],
        "yaxes": [
          { "label": "EUR/s", "format": "currencyEUR" },
          { "show": false }
        ]
      },
      {
        "id": 8,
        "title": "Handoffs to Human",
        "type": "graph",
        "gridPos": { "x": 0, "y": 22, "w": 12, "h": 6 },
        "targets": [
          {
            "expr": "rate(anclora_analytics_handoffs_total[5m])",
            "legendFormat": "{{reason}}"
          }
        ]
      },
      {
        "id": 9,
        "title": "Response Time Distribution",
        "type": "heatmap",
        "gridPos": { "x": 12, "y": 22, "w": 12, "h": 6 },
        "targets": [
          {
            "expr": "rate(anclora_analytics_response_time_seconds_bucket[5m])",
            "format": "heatmap"
          }
        ],
        "dataFormat": "tsbuckets"
      },
      {
        "id": 10,
        "title": "Today's Conversions",
        "type": "stat",
        "gridPos": { "x": 0, "y": 28, "w": 6, "h": 4 },
        "targets": [
          {
            "expr": "sum(increase(anclora_analytics_conversions_total{conversion_type='sale'}[24h]))"
          }
        ],
        "options": {
          "colorMode": "value",
          "graphMode": "area"
        }
      },
      {
        "id": 11,
        "title": "Today's Revenue (EUR)",
        "type": "stat",
        "gridPos": { "x": 6, "y": 28, "w": 6, "h": 4 },
        "targets": [
          {
            "expr": "sum(increase(anclora_analytics_conversion_value_euros_sum[24h]))"
          }
        ],
        "options": {
          "unit": "currencyEUR",
          "colorMode": "value",
          "graphMode": "area"
        }
      },
      {
        "id": 12,
        "title": "Leads Captured Today",
        "type": "stat",
        "gridPos": { "x": 12, "y": 28, "w": 6, "h": 4 },
        "targets": [
          {
            "expr": "sum(increase(anclora_analytics_conversions_total{conversion_type='lead'}[24h]))"
          }
        ],
        "options": {
          "colorMode": "value",
          "graphMode": "area"
        }
      },
      {
        "id": 13,
        "title": "Appointments Scheduled Today",
        "type": "stat",
        "gridPos": { "x": 18, "y": 28, "w": 6, "h": 4 },
        "targets": [
          {
            "expr": "sum(increase(anclora_analytics_conversions_total{conversion_type='appointment'}[24h]))"
          }
        ],
        "options": {
          "colorMode": "value",
          "graphMode": "area"
        }
      }
    ],
    "refresh": "10s",
    "time": {
      "from": "now-1h",
      "to": "now"
    }
  }
}
